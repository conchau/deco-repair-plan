{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"/Users/connorchau/Desktop/deco-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/connorchau/Desktop/deco-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/connorchau/Desktop/deco-app/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import axiosConfig from\"./axiosConfig\";import Footer from\"./Footer\";import{Link,Switch,Route,useHistory}from'react-router-dom';import ArrowBackIcon from'@material-ui/icons/ArrowBack';import{CardElement,Elements,useElements,useStripe}from\"@stripe/react-stripe-js\";import{loadStripe}from'@stripe/stripe-js';var stripePromise=loadStripe(process.env.REACT_APP_PUBLISHABLE_KEY);function Checkout(props){var history=useHistory();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),emailAddress=_useState2[0],setEmailAddress=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isProcessing=_useState4[0],setProcessingTo=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),succeeded=_useState6[0],setSucceeded=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),error=_useState8[0],setError=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),disabled=_useState10[0],setDisabled=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),clientSecret=_useState12[0],setClientSecret=_useState12[1];var _useState13=useState(\"undefined\"),_useState14=_slicedToArray(_useState13,2),customerAddError=_useState14[0],setCustomerAddError=_useState14[1];var _useState15=useState(\"undefined\"),_useState16=_slicedToArray(_useState15,2),invoiceAddError=_useState16[0],setInvoiceAddError=_useState16[1];var userID=props.location.state.userID;var province=props.location.state.province;var fullName=props.location.state.fullName;var licensePlate=props.location.state.licensePlate;var vehicleInfo=props.location.state.vehicleInfo;var phoneNumber=props.location.state.phoneNumber;var planType=props.location.state.planType;var basicCount=props.location.state.basicCount;var premiumCount=props.location.state.premiumCount;var serviceRepair=props.location.state.serviceRepair;var repairItems=props.location.state.repairItems;var subtotalBeforeDiscount=props.location.state.subtotalBeforeDiscount;var discount=props.location.state.discount;var taxes=props.location.state.taxes;var total=props.location.state.total;var customerName1=props.location.state.customerName1;var licensePlate1=props.location.state.licensePlate1;var vehicleInfo1=props.location.state.vehicleInfo1;var additionalPlanType1=props.location.state.additionalPlanType1;var customerName2=props.location.state.customerName2;var licensePlate2=props.location.state.licensePlate2;var vehicleInfo2=props.location.state.vehicleInfo2;var additionalPlanType2=props.location.state.additionalPlanType2;var customerName3=props.location.state.customerName3;var licensePlate3=props.location.state.licensePlate3;var vehicleInfo3=props.location.state.vehicleInfo3;var additionalPlanType3=props.location.state.additionalPlanType3;var customerName4=props.location.state.customerName4;var licensePlate4=props.location.state.licensePlate4;var vehicleInfo4=props.location.state.vehicleInfo4;var additionalPlanType4=props.location.state.additionalPlanType4;var stripe=useStripe();var elements=useElements();// Create PaymentIntent as soon as the page loads\nuseEffect(function(){window.fetch(\"http://localhost:4000/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({items:Math.floor(total*100)})}).then(function(res){return res.json();}).then(function(data){setClientSecret(data.clientSecret);});},[]);var cardStyle={hidePostalCode:true,style:{base:{color:\"#32325d\",fontFamily:'Arial, sans-serif',fontSmoothing:\"antialiased\",fontSize:\"16px\",\"::placeholder\":{color:\"#32325d\"}},invalid:{color:\"#fa755a\",iconColor:\"#fa755a\"}}};var handleChange=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Listen for changes in the CardElement\n// and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleChange(_x){return _ref.apply(this,arguments);};}();function handleEmailInput(event){setEmailAddress(event.target.value);}var handleFormSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:event.preventDefault();setProcessingTo(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}});case 4:payload=_context2.sent;if(payload.error){setError(\"Payment failed \".concat(payload.error.message));setProcessingTo(false);}else{setError(null);setProcessingTo(false);setSucceeded(true);//Add main customer to database\naxiosConfig.post(\"/customer/insert\",{province:province,fullName:fullName,licensePlate:licensePlate,vehicleInfo:vehicleInfo,planType:planType,phoneNumber:phoneNumber,email:emailAddress}).then(function(response){console.log(response.data.errno);setCustomerAddError(response.data.errno);});//If necessary, add additional customers to database\nif(customerName1!==\"\"){axiosConfig.post(\"/customer/insert\",{province:province,fullName:customerName1,licensePlate:licensePlate1,vehicleInfo:vehicleInfo1,planType:additionalPlanType1,phoneNumber:phoneNumber,email:emailAddress});}if(customerName2!==\"\"){axiosConfig.post(\"/customer/insert\",{province:province,fullName:customerName2,licensePlate:licensePlate2,vehicleInfo:vehicleInfo2,planType:additionalPlanType2,phoneNumber:phoneNumber,email:emailAddress});}if(customerName3!==\"\"){axiosConfig.post(\"/customer/insert\",{province:province,fullName:customerName3,licensePlate:licensePlate3,vehicleInfo:vehicleInfo3,planType:additionalPlanType3,phoneNumber:phoneNumber,email:emailAddress});}if(customerName4!==\"\"){axiosConfig.post(\"/customer/insert\",{province:province,fullName:customerName4,licensePlate:licensePlate4,vehicleInfo:vehicleInfo4,planType:additionalPlanType4,phoneNumber:phoneNumber,email:emailAddress});}// //Add invoice to database\naxiosConfig.post(\"/invoice/insert\",{userID:userID,province:province,planType:planType,basicCount:basicCount,premiumCount:premiumCount,serviceRepair:serviceRepair,repairItems:repairItems,subtotalBeforeDiscount:subtotalBeforeDiscount,discount:discount,taxes:taxes,total:total,fullName:fullName,licensePlate:licensePlate,vehicleInfo:vehicleInfo,phoneNumber:phoneNumber,email:emailAddress}).then(function(response){console.log(response.data.errno);setInvoiceAddError(response.data.errno);});history.push(\"/checkoutconfirmed\");}case 6:case\"end\":return _context2.stop();}}},_callee2);}));return function handleFormSubmit(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"page-container\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"page-header\",children:\"Checkout\"}),/*#__PURE__*/_jsx(\"label\",{className:\"lookup-label\",children:\"Email Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Email Address\",className:\"checkout-input\",onChange:handleEmailInput}),/*#__PURE__*/_jsx(\"div\",{className:\"stripe-form\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleFormSubmit,children:[/*#__PURE__*/_jsx(CardElement,{id:\"card-element\",className:\"card-input\",options:cardStyle,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{className:\"pay-button\",disabled:isProcessing,children:/*#__PURE__*/_jsx(\"span\",{id:\"button-text\",children:isProcessing?/*#__PURE__*/_jsx(\"div\",{className:\"spinner\",id:\"spinner\"}):\"Pay $\".concat(total)})}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"card-error\",role:\"alert\",children:error}),/*#__PURE__*/_jsxs(\"p\",{className:succeeded?\"result-message\":\"result-message hidden\",children:[\"Payment succeeded, see the result in your\",/*#__PURE__*/_jsxs(\"a\",{href:\"https://dashboard.stripe.com/test/payments\",children:[\" \",\"Stripe dashboard.\"]}),\" Refresh the page to pay again.\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"lookup-footer\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"back-button\",onClick:function onClick(){return history.push(\"/payment\");},children:/*#__PURE__*/_jsx(ArrowBackIcon,{})}),/*#__PURE__*/_jsx(Footer,{})]})]});}export default Checkout;","map":{"version":3,"sources":["/Users/connorchau/Desktop/deco-app/client/src/components/Checkout.jsx"],"names":["React","useState","useEffect","axiosConfig","Footer","Link","Switch","Route","useHistory","ArrowBackIcon","CardElement","Elements","useElements","useStripe","loadStripe","stripePromise","process","env","REACT_APP_PUBLISHABLE_KEY","Checkout","props","history","emailAddress","setEmailAddress","isProcessing","setProcessingTo","succeeded","setSucceeded","error","setError","disabled","setDisabled","clientSecret","setClientSecret","customerAddError","setCustomerAddError","invoiceAddError","setInvoiceAddError","userID","location","state","province","fullName","licensePlate","vehicleInfo","phoneNumber","planType","basicCount","premiumCount","serviceRepair","repairItems","subtotalBeforeDiscount","discount","taxes","total","customerName1","licensePlate1","vehicleInfo1","additionalPlanType1","customerName2","licensePlate2","vehicleInfo2","additionalPlanType2","customerName3","licensePlate3","vehicleInfo3","additionalPlanType3","customerName4","licensePlate4","vehicleInfo4","additionalPlanType4","stripe","elements","window","fetch","method","headers","body","JSON","stringify","items","Math","floor","then","res","json","data","cardStyle","hidePostalCode","style","base","color","fontFamily","fontSmoothing","fontSize","invalid","iconColor","handleChange","event","empty","message","handleEmailInput","target","value","handleFormSubmit","preventDefault","confirmCardPayment","payment_method","card","getElement","payload","post","email","response","console","log","errno","push"],"mappings":"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","sourcesContent":["import React, {useState, useEffect} from \"react\";\nimport axiosConfig from \"./axiosConfig\";\nimport Footer from \"./Footer\";\nimport { Link, Switch, Route, useHistory } from 'react-router-dom';\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack';\nimport { CardElement, Elements, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from '@stripe/stripe-js';\n\nconst stripePromise = loadStripe(process.env.REACT_APP_PUBLISHABLE_KEY);\n\nfunction Checkout(props) {\n    const history = useHistory();\n\n    const [emailAddress, setEmailAddress] = useState(\"\");\n    const [isProcessing, setProcessingTo] = useState(false);\n    const [succeeded, setSucceeded] = useState(false);\n    const [error, setError] = useState(null);\n    const [disabled, setDisabled] = useState(true);\n    const [clientSecret, setClientSecret] = useState('');\n    const [customerAddError, setCustomerAddError] = useState(\"undefined\");\n    const [invoiceAddError, setInvoiceAddError] = useState(\"undefined\");\n\n    const userID = props.location.state.userID;\n    const province = props.location.state.province;\n    const fullName = props.location.state.fullName;\n    const licensePlate = props.location.state.licensePlate;\n    const vehicleInfo = props.location.state.vehicleInfo;\n    const phoneNumber = props.location.state.phoneNumber;\n    const planType = props.location.state.planType;\n    const basicCount = props.location.state.basicCount;\n    const premiumCount = props.location.state.premiumCount;\n    const serviceRepair = props.location.state.serviceRepair;\n    const repairItems = props.location.state.repairItems;\n    const subtotalBeforeDiscount = props.location.state.subtotalBeforeDiscount;\n    const discount = props.location.state.discount;\n    const taxes = props.location.state.taxes;\n    const total = props.location.state.total;\n    const customerName1 = props.location.state.customerName1;\n    const licensePlate1 = props.location.state.licensePlate1;\n    const vehicleInfo1 = props.location.state.vehicleInfo1;\n    const additionalPlanType1 = props.location.state.additionalPlanType1;\n    const customerName2 = props.location.state.customerName2;\n    const licensePlate2 = props.location.state.licensePlate2;\n    const vehicleInfo2 = props.location.state.vehicleInfo2;\n    const additionalPlanType2 = props.location.state.additionalPlanType2;\n    const customerName3 = props.location.state.customerName3;\n    const licensePlate3 = props.location.state.licensePlate3;\n    const vehicleInfo3 = props.location.state.vehicleInfo3;\n    const additionalPlanType3 = props.location.state.additionalPlanType3;\n    const customerName4 = props.location.state.customerName4;\n    const licensePlate4 = props.location.state.licensePlate4;\n    const vehicleInfo4 = props.location.state.vehicleInfo4;\n    const additionalPlanType4 = props.location.state.additionalPlanType4;\n\n    const stripe = useStripe();\n    const elements = useElements();\n\n    // Create PaymentIntent as soon as the page loads\n    useEffect(() => {\n        window\n          .fetch(\"http://localhost:4000/create-payment-intent\", {\n            method: \"POST\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({items: Math.floor(total * 100)})\n          })\n          .then(res => {\n            return res.json();\n          })\n          .then(data => {\n            setClientSecret(data.clientSecret);\n          });\n      }, []);\n\n    const cardStyle = {\n      hidePostalCode: true,\n      style: {\n          base: {\n            color: \"#32325d\",\n            fontFamily: 'Arial, sans-serif',\n            fontSmoothing: \"antialiased\",\n            fontSize: \"16px\",\n            \"::placeholder\": {\n              color: \"#32325d\"\n            }\n          },\n          invalid: {\n            color: \"#fa755a\",\n            iconColor: \"#fa755a\"\n          }\n        }\n      };\n\n    const handleChange = async (event) => {\n        // Listen for changes in the CardElement\n        // and display any errors as the customer types their card details\n        setDisabled(event.empty);\n        setError(event.error ? event.error.message : \"\");\n      };\n\n    function handleEmailInput(event) {\n        setEmailAddress(event.target.value);\n    }\n\n    const handleFormSubmit = async (event) => {\n        event.preventDefault();\n        setProcessingTo(true);\n\n        const payload = await stripe.confirmCardPayment(clientSecret, {\n            payment_method: {\n              card: elements.getElement(CardElement)\n            }\n          });\n          if (payload.error) {\n            setError(`Payment failed ${payload.error.message}`);\n            setProcessingTo(false);\n          } else {\n            setError(null);\n            setProcessingTo(false);\n            setSucceeded(true);\n\n            //Add main customer to database\n            axiosConfig.post(\"/customer/insert\", {\n                province: province,\n                fullName: fullName,\n                licensePlate: licensePlate,\n                vehicleInfo: vehicleInfo,\n                planType: planType,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n            }).then((response) => {\n                console.log(response.data.errno);\n                setCustomerAddError(response.data.errno);\n            });\n\n            //If necessary, add additional customers to database\n            if (customerName1 !== \"\"){\n              axiosConfig.post(\"/customer/insert\", {\n                province: province,\n                fullName: customerName1,\n                licensePlate: licensePlate1,\n                vehicleInfo: vehicleInfo1,\n                planType: additionalPlanType1,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n              });\n            }\n\n            if (customerName2 !== \"\"){\n              axiosConfig.post(\"/customer/insert\", {\n                province: province,\n                fullName: customerName2,\n                licensePlate: licensePlate2,\n                vehicleInfo: vehicleInfo2,\n                planType: additionalPlanType2,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n              });\n            }\n\n            if (customerName3 !== \"\"){\n              axiosConfig.post(\"/customer/insert\", {\n                province: province,\n                fullName: customerName3,\n                licensePlate: licensePlate3,\n                vehicleInfo: vehicleInfo3,\n                planType: additionalPlanType3,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n              });\n            }\n\n            if (customerName4 !== \"\"){\n              axiosConfig.post(\"/customer/insert\", {\n                province: province,\n                fullName: customerName4,\n                licensePlate: licensePlate4,\n                vehicleInfo: vehicleInfo4,\n                planType: additionalPlanType4,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n              });\n            }\n\n            // //Add invoice to database\n            axiosConfig.post(\"/invoice/insert\", {\n                userID: userID,\n                province: province,\n                planType: planType,\n                basicCount: basicCount,\n                premiumCount: premiumCount,\n                serviceRepair: serviceRepair,\n                repairItems: repairItems,\n                subtotalBeforeDiscount: subtotalBeforeDiscount,\n                discount: discount,\n                taxes: taxes,\n                total: total,\n                fullName: fullName,\n                licensePlate: licensePlate,\n                vehicleInfo: vehicleInfo,\n                phoneNumber: phoneNumber,\n                email: emailAddress\n            }).then((response) => {\n                console.log(response.data.errno);\n                setInvoiceAddError(response.data.errno);\n            });\n\n            (history.push(\"/checkoutconfirmed\"));\n          }\n      };\n\n    return (\n    <div className=\"page-container\">\n        <h1 className=\"page-header\">Checkout</h1>\n        <label className=\"lookup-label\">Email Address</label>\n            <input type=\"text\" placeholder=\"Email Address\" className=\"checkout-input\" onChange={handleEmailInput}/>\n        <div className=\"stripe-form\">\n            <form onSubmit={handleFormSubmit}>\n            <CardElement id=\"card-element\" className=\"card-input\" options={cardStyle} onChange={handleChange} />\n            <button className=\"pay-button\" disabled={isProcessing}>\n                <span id=\"button-text\">\n                {isProcessing ? (\n                    <div className=\"spinner\" id=\"spinner\"></div>\n                ) : (\n                    `Pay $${total}`\n                )}\n                </span>\n            </button>\n            {/* Show any error that happens when processing the payment */}\n            {error && (\n                <div className=\"card-error\" role=\"alert\">\n                {error}\n                </div>\n            )}\n            {/* Show a success message upon completion */}\n            <p className={succeeded ? \"result-message\" : \"result-message hidden\"}>\n                Payment succeeded, see the result in your\n                <a\n                href={`https://dashboard.stripe.com/test/payments`}\n                >\n                {\" \"}\n                Stripe dashboard.\n                </a> Refresh the page to pay again.\n            </p>\n            </form>\n            {/* <p>Customer Add Error: {customerAddError}</p>\n            <p>Invoice Add Error: {invoiceAddError}</p>\n            {customerAddError === undefined && invoiceAddError === undefined && (\n                <p>NO ERROR!</p>\n            )} */}\n        </div>\n        <div className=\"lookup-footer\">\n            <button\n                className=\"back-button\"\n                onClick={() => history.push(\"/payment\")}>\n                <ArrowBackIcon></ArrowBackIcon>\n            </button>\n            <Footer />\n        </div>\n    </div>\n    )\n}\n\nexport default Checkout;"]},"metadata":{},"sourceType":"module"}